<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:jsf="http://xmlns.jcp.org/jsf"
      xmlns:pt="http://java.sun.com/jsf/passthrough"
      xmlns:cc="http://java.sun.com/jsf/composite"
      xmlns:o="http://omnifaces.org/ui"
      xmlns:iqbs="http://xmlns.jcp.org/jsf/composite/iqbs">
    <h:head>
    </h:head>
     
    <h:body>
		<ui:composition template="/dataverse_pivot_template.xhtml">
			<ui:param name="pageTitle" value="#{PivotPage.fileMetadata.dataFile.displayName} - #{PivotPage.file.owner.owner.displayName}"/>
	
        <ui:define name="body">
			<f:metadata>
				<f:viewParam name="fileId" value="#{PivotPage.fileId}"/>
				<f:viewAction action="#{PivotPage.init}" />	
				<f:viewAction action="#{dataverseHeaderFragment.initBreadcrumbsForFileMetadata(PivotPage.file,'Pivot Table')}"/>
			</f:metadata>
			<!-- Title/Label -->
	         <script type="text/javascript">
				    // This example loads the "Canadian Parliament 2012"
				    // dataset from a CSV instead of from JSON.
				
				    $(function(){
				        Papa.parse("#{PivotPage.csvFilePath}", {
				            download: true,
				            skipEmptyLines: true,
				            complete: function(parsed){
				                $("#output").pivotUI(parsed.data, {
				                    rows: "#{PivotPage.rowVariables}", cols: "#{PivotPage.colVariables}",vals: "#{PivotPage.valVariables}",
									aggregatorName: "Sum",
									renderName: "Table",
									renderers: $.extend(
				                        $.pivotUtilities.renderers,
				                        $.pivotUtilities.c3_renderers,
				                        $.pivotUtilities.export_renderers
				                        ),
				                });
				            }
				        });
				     });
	        </script>
	        <p style="width: 800px"></p>
        	<div id="output" style="margin: 30px;"></div>
	        
        </ui:define>
        </ui:composition>
   </h:body>
</html>
